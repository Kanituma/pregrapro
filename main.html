<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Document</title>
    <link rel="stylesheet" href="css/style.css" type="text/css" />
</head>
<body>
<!-- loading -->
    <div id="loading">
        <img class="loader" src="images/load.gif">
    </div>
<!-- 画廊外部 -->
    <div class="page1">
        <div id="opbtn"></div>
        <div id="open">
            <img src="images/sprite2.jpg" alt="" id="openani">
        </div>
    </div>
    <div class="white"></div>

<!-- 画廊内部 -->
    <div class="page2">
            <div class="slide one rellax" data-rellax-speed="5" >
                <span class="one-r"></span>
                <div class="img img-b ione">
                    <img src="images/p1.png" class="pic-b">
                    <div class="mask">
                        <img src="images/click.gif" alt="" id="click">
                        <img src="images/clickrm.png" alt="" id="clrm">
                       
                    </div>
                </div>
                <img src="images/light-b.png" class="light lone rellax" data-rellax-speed="1">
                <img src="images/fence1.png" class="plant pone rellax" data-rellax-speed="1.3">
            </div>
            
            <div class="slide two rellax" data-rellax-speed="3">
                <div class="img img-s itwo">
                    <img src="images/p2.png" class="pic-s">
                    <div class="mask">
                        <img src="images/click.gif" alt="" id="click">
                        <img src="images/clickrm.png" alt="" id="clrm">
                       
                    </div>
                </div>
                <img src="images/light-s.png" class="light ltwo rellax" data-rellax-speed="0.5">
                 <img src="images/plant2.png" class="plant ptwo rellax" data-rellax-speed="0.8">
            </div>
           
            <div class="slide three rellax" data-rellax-speed="5">
                <span class="three-r"></span>
                <div class="img img-b ithree">
                    <img src="images/p3.png" class="pic-b">
                    <div class="mask">
                        <img src="images/click.gif" alt="" id="click">
                        <img src="images/clickrm.png" alt="" id="clrm">
                       
                    </div>
                </div>
                <img src="images/light-b.png" class="light lthree rellax" data-rellax-speed="1">
                 <img src="images/chair3.png" class="plant pthree rellax" data-rellax-speed="1.3">
            </div>
           
            <div class="slide four rellax" data-rellax-speed="4">
                <div class="img img-s ifour">
                    <img src="images/p4.png" class="pic-s">
                    <div class="mask">
                        <img src="images/click.gif" alt="" id="click">
                        <img src="images/clickrm.png" alt="" id="clrm">
                       
                    </div>
                </div>
                <img src="images/light-s.png" class="light lfour rellax" data-rellax-speed="0.8">
                 <img src="images/plant4.png" class="plant pfour rellax" data-rellax-speed="0.8">
            </div>
           
            <div class="slide five rellax" data-rellax-speed="6">
                <span class="five-r"></span>
                <div class="img img-b ifive">
                    <img src="images/p5.png" class="pic-b">
                    <div class="mask">
                        <img src="images/click.gif" alt="" id="click">
                        <img src="images/clickrm.png" alt="" id="clrm">
                       
                    </div>
                </div>
                <img src="images/light-b.png" class="light lfive rellax" data-rellax-speed="1">
                <img src="images/dog5.png" class="plant pfive rellax" data-rellax-speed="0.8">
            </div>
            
            <div class="slide six rellax" data-rellax-speed="4" id="ssix">
                <div class="img img-s isix">
                    <img src="images/p6.png" class="pic-s">
                    <div class="mask">
                        <img src="images/click.gif" alt="" id="click">
                        <img src="images/clickrm.png" alt="" id="clrm">
                       
                    </div>
                </div>
                <img src="images/light-s.png" class="light lsix rellax" data-rellax-speed="0.5">
                <img src="images/plant6.png" class="plant psix rellax" data-rellax-speed="0.8">
            </div>
            <div id="flrdiv" class="rellax" data-rellax-speed="5">
                <div id="floor"></div>
            </div>
    </div>   

<!-- 拼图部分 -->
    <div class="page3">
        <div class="pframe">
            <svg id="puzzle" viewBox="0,0,400,800" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <g id="back" opacity="0"><image xlink:href="images/p_p6.png" width="268.7" height="361" x="65.65" y="169.5"></g>
                <g id="backframe"><image xlink:href="images/puzzle_lines.png" width="268.7" height="361" x="65.65" y="169.5"></g>
                <g class="piece" id="0"><image xlink:href="images/p6_1.png" class="move" id="piece1"></image></g>
                <g class="piece" id="1"><image xlink:href="images/p6_2.png" class="move" id="piece2"></image></g>
                <g class="piece" id="2"><image xlink:href="images/p6_3.png" class="move" id="piece3"></image></g>
                <g class="piece" id="3"><image xlink:href="images/p6_4.png" class="move" id="piece4"></image></g>
                <g class="piece" id="4"><image xlink:href="images/p6_5.png" class="move" id="piece5"></image></g>
                <g class="piece" id="5"><image xlink:href="images/p6_6.png" class="move" id="piece6"></image></g>
            </svg>
        </div>
        <d id="gif_content">
            <div id="p_gif"></div>
        </d>
        <img src="images/p1_title.png" alt="" id="p_title"> 
        <div id="p_back"></div>
        <div id="p_tip"></div>
        <div id="p_story">
            <div id="p_words"></div>
           <div id="p_share"></div> 
        </div>
        <div id="blackbg"></div>
        <audio src="audio/right.mp3" id="right"></audio>
    </div>

<!-- 海报生成 -->
    <div class="page4">

    </div>
</body>
<script src="js/rellax.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.0/jquery.js"></script>
<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
<script id="reloadpuzzle" src="js/puzzle.js"></script>
<script>
$(".page3").hide()
var queue = new createjs.LoadQueue(false);
queue.on("progress",event =>{
    $("#loading").css("transition","1.7s")
})
queue.on("complete",event =>{
    MuApp()
})
// queue.on("fileload",MuApp)
//大于500k的预加载
queue.loadFile("images/sprite.jpg")
queue.loadFile("images/floor.png")
queue.loadFile("images/wall4.png")
queue.loadFile("images/wall2.png")
queue.loadFile("images/wall6.png")
queue.loadFile("images/wall5.png")
// queue.loadFile("images/p1_sprite.jpg")
// queue.loadFile("images/p2_sprite.jpg")
// queue.loadFile("images/p3_sprite.jpg")
// queue.loadFile("images/p4_sprite.jpg")
// queue.loadFile("images/p5_sprite.jpg")
// queue.loadFile("images/p6_sprite.jpg")

var winh = Math.floor(innerHeight/100)
console.log(winh)
if(winh>=8){
    $("#p_title").css("top","16vh")
    // $("#p_story p").css("line-height","7vw")
    $("#p_story").css("top","51%")
}
if(winh ==7){
    console.log("ye!")
    // $("#p_story p").css("line-height","7vw")
}
if(winh ==6){
    console.log("ye!")
    $("#p_story").css("top","51.5%")
    // $("#p_story p").css("line-height","7vw")
}
function MuApp(){
    $(".loader").css("opacity","0");
    setTimeout(function(){$("#loading").css("opacity","0");},100)
    var h = $(window).height();
    var w = $(window).width();
    var timesop = h / 640;
    var timespgif = 0.94*w/538 ;
    $("#open").css("transform","translate(-50%,-50%) scale("+timesop+")")
    $("#openani").css("animation","anim1 4s 1s steps(76) both")
    $("#p_gif").css("transform","translate(-50%,-50%) scale("+timespgif+")")
    console.log("sdfsdf")
    
    
    
    var flag = true;
     setInterval(function(){
        
        $('#openani').on('animationend webkitAnimationEnd', function() { 
            if(flag == true){
                $("#opbtn").css("opacity","1");
                setTimeout(function(){
                    flag = false;
                },200)
                console.log(flag)
            }
            if(flag == false){              
                    $(".white").css("opacity","0")
                    $(".page1").css("display","none")
                    $("#loading").css("display","none")
            }
             
        });
    },100)
    $("#opbtn").click(function(){
        $("#openani").css("animation","anim2 1s 1s steps(17) both")
        $("#opbtn").css("opacity","0")
    })
    var rellax = new Rellax('.rellax', {
        speed: -2,
        center: false,
        wrapper: null,
        round: true,
        vertical: false,
        horizontal: true
    })
    $(document).scroll(function() {
        var w = $("#ssix").offset().left + $("#ssix").width()
        $(".page2").css("width",w)
    })
    
        
    // })
    var pici;
    $(".img").bind("click",function(){
        pici = $(".img").index($(this))+1
        changeImage()
        // console.log("这是第"+(pici+1)+"张画")
        $("#puzzle").fadeIn();
        $(".page3").fadeIn("slow");
        
        // $("#back").hide()
        
    })
    var gifSteps = ["steps(49)","steps(49)","steps(19)","steps(49)","steps(29)","steps(49)"];
    var gifWidth = ["-19600px","-19600px","-7600px","-19600px","-11600px","-19600px"];
    var gifDuration = ["5s","5s","2s","5s","3s","5s"];

    function changeImage() {
        $("#piece1").attr("xlink:href","images/p"+pici+"_1.png")
        $("#piece2").attr("xlink:href","images/p"+pici+"_2.png")
        $("#piece3").attr("xlink:href","images/p"+pici+"_3.png")
        $("#piece4").attr("xlink:href","images/p"+pici+"_4.png")
        $("#piece5").attr("xlink:href","images/p"+pici+"_5.png")
        $("#piece6").attr("xlink:href","images/p"+pici+"_6.png")
        $("#back image").attr("xlink:href","images/p_p"+pici+".png")
        $("#p_title").attr("src","images/p"+pici+"_title.png")
        $("#p_tip").css("background-image","url('../images/puzzle_tip.png')")
        changePani(pici,gifSteps[pici-1],gifWidth[pici-1],gifDuration[pici-1])
       
    }
    function changePani(index,steps,width,duration){
        $("#p_gif").css("background-image","url('../images/p"+index+"_sprite.jpg'")
        $("#p_story").css("background-image","url('../images/story_bg_"+index+".png'")
        $("#p_words").css("background-image","url('../images/story"+index+".png'")
        document.documentElement.style.setProperty("--steps", steps);
        document.documentElement.style.setProperty("--width", width);
        document.documentElement.style.setProperty("--duration", duration);
        // console.log($("#p_gif").css("animation-timing-function"))
        
    }
}

</script>

</html>
  